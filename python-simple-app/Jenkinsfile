pipeline {
    agent {
        label 'master'
    }
    stages {
        stage('build') {
            steps {
                bat 'pip install -r s05\\python-simple-app\\requirements.txt'
            }
        }

        stage('run') {
            steps {
                bat 'start /B python s05\\python-simple-app\\app.py'
            }
        }

        stage('test') {
            steps {
                bat 'timeout /t 60 && curl -s localhost:8000'
            }
        }

        stage('cleanup') {
            steps {
                bat 'taskkill /F /PID (netstat -ano | findstr ":8000" | findstr /R "[0-9]*$")'
            }
        }
    }
}
